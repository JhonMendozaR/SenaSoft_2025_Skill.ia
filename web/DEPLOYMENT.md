# 🚀 Guía de Despliegue en Render - Skill.IA Frontend

Esta guía te muestra cómo desplegar el frontend de Skill.IA en Render.

## 📋 Requisitos Previos

1. **Cuenta en Render**: Crea una cuenta gratuita en [render.com](https://render.com)
2. **Repositorio Git**: Tu código debe estar en GitHub, GitLab o Bitbucket
3. **Groq API Key**: Obtén tu clave en [console.groq.com/keys](https://console.groq.com/keys)

---

## 🎯 Método 1: Despliegue Automático con Blueprint (Recomendado)

El archivo `render.yaml` en la raíz del proyecto configura todo automáticamente.

### Pasos:

1. **Inicia sesión en Render**
   - Ve a [dashboard.render.com](https://dashboard.render.com)

2. **Crea un nuevo Blueprint**
   - Click en **"New +"** → **"Blueprint"**
   - Selecciona tu repositorio: `JhonMendozaR/SenaSoft_2025_Skill.ia`
   - Render detectará automáticamente el `render.yaml`

3. **Configura las Variables de Entorno**
   - En el dashboard, ve a tu servicio `skillai-frontend`
   - Click en **"Environment"** en el menú lateral
   - Agrega la variable:
     ```
     PUBLIC_GROQ_API_KEY = tu_clave_de_groq_aqui
     ```
   - Click en **"Save Changes"**

4. **Deplegar**
   - Render construirá automáticamente tu aplicación
   - El proceso toma ~3-5 minutos
   - Una vez completado, recibirás una URL: `https://skillai-frontend.onrender.com`

---

## 🔧 Método 2: Despliegue Manual

Si prefieres configurar manualmente:

### Paso 1: Crear Servicio

1. **En el Dashboard de Render**
   - Click en **"New +"** → **"Static Site"**

2. **Conectar Repositorio**
   - Selecciona tu repositorio Git
   - Dale permisos a Render

### Paso 2: Configurar Build

```yaml
Name: skillia-frontend
Root Directory: web
Build Command: npm install && npm run build
Publish Directory: web/dist
```

### Paso 3: Configuración Avanzada

**Auto-Deploy**: ✅ Activado (depliegue automático en cada push)

**Branch**: `main` (o `deploy` si usas esa rama)

### Paso 4: Variables de Entorno

En **Environment Variables**, agrega:

| Key | Value |
|-----|-------|
| `PUBLIC_GROQ_API_KEY` | `gsk_tu_clave_aqui` |
| `NODE_VERSION` | `22.20.0` |

### Paso 5: Desplegar

- Click en **"Create Static Site"**
- Render empezará a construir tu aplicación

---

## 🌍 Configuración Post-Despliegue

### 1. Actualizar URL del Sitio

Una vez que tengas tu URL de Render, actualiza `astro.config.mjs`:

```javascript
export default defineConfig({
  site: 'https://tu-app.onrender.com',  // ← Actualizar con tu URL real
  // ...resto de la configuración
});
```

Luego haz commit y push:

```bash
git add web/astro.config.mjs
git commit -m "chore: update site URL for production"
git push origin main
```

### 2. Configurar Dominio Personalizado (Opcional)

Si tienes un dominio propio:

1. En el Dashboard de Render → **Settings** → **Custom Domains**
2. Click en **"Add Custom Domain"**
3. Ingresa tu dominio: `skillai.tudominio.com`
4. Sigue las instrucciones para configurar DNS

---

## 🔍 Verificar el Despliegue

### 1. Verificar que la App Carga

Visita tu URL de Render y verifica:
- ✅ La página principal carga
- ✅ Puedes navegar a `/login`, `/diagnostic`, `/roadmap`, `/chat`
- ✅ Los estilos se ven correctos

### 2. Verificar Groq API

1. Abre la consola del navegador (F12)
2. Ve a la página `/diagnostic`
3. Inicia una evaluación
4. En la consola deberías ver:
   ```
   ✅ Groq client initialized successfully
   🤖 Generating question...
   ✅ Question generated by Groq
   ```

Si ves `⚠️ Groq API key not found`, revisa las variables de entorno.

---

## 🚨 Solución de Problemas

### Problema: Build falla con "Command not found"

**Solución**: Verifica que el Root Directory esté configurado como `web`

```yaml
Root Directory: web
Build Command: npm install && npm run build
```

### Problema: "PUBLIC_GROQ_API_KEY is not defined"

**Solución**: 
1. Ve a Dashboard → Environment
2. Asegúrate de que la variable tenga el prefijo `PUBLIC_`
3. Guarda cambios y redeploy manualmente

### Problema: Páginas muestran 404

**Solución**: Asegúrate de que `Publish Directory` sea `web/dist`

### Problema: Assets no cargan (CSS/JS)

**Solución**: Verifica la configuración en `astro.config.mjs`:

```javascript
build: {
  assets: '_astro',
  format: 'directory'
}
```

### Problema: Build toma demasiado tiempo

**Solución**: Render free tier puede ser lento. Considera:
- Usar caching de npm en Render
- Optimizar dependencias

---

## 🔄 Actualizar el Despliegue

### Despliegue Automático

Si configuraste Auto-Deploy:

```bash
# Haz tus cambios
git add .
git commit -m "feat: nueva funcionalidad"
git push origin main
```

Render detectará el push y re-desplegará automáticamente.

### Despliegue Manual

En el Dashboard de Render:
1. Ve a tu servicio
2. Click en **"Manual Deploy"** → **"Deploy latest commit"**

---

## 📊 Monitoreo

### Logs

Para ver logs en tiempo real:
1. Dashboard → Tu servicio
2. Click en **"Logs"**
3. Verás el output del build y cualquier error

### Métricas

Render muestra:
- Tiempo de build
- Tamaño del deploy
- Tráfico de red
- Uptime

---

## 🔐 Seguridad

### Variables de Entorno Sensibles

- ✅ **SÍ** agregues: `PUBLIC_GROQ_API_KEY`
- ❌ **NO** hagas commit de archivos `.env` con claves reales
- ❌ **NO** expongas claves en el código fuente

### Headers de Seguridad

Ya están configurados en `render.yaml`:
- `X-Frame-Options: DENY` (previene clickjacking)
- `X-Content-Type-Options: nosniff` (previene MIME sniffing)
- `Referrer-Policy: strict-origin-when-cross-origin`

---

## 💰 Costos

### Plan Free

- ✅ **GRATIS** para sitios estáticos
- ✅ 100 GB de ancho de banda/mes
- ✅ SSL automático
- ✅ CDN global
- ⚠️ Puede tener tiempos de build más lentos

### Plan Starter ($7/mes)

- ⚡ Builds más rápidos
- 📊 Más ancho de banda
- 🎯 Soporte prioritario

---

## 🎓 Recursos Adicionales

- [Documentación de Render](https://render.com/docs/static-sites)
- [Documentación de Astro](https://docs.astro.build/en/guides/deploy/render/)
- [Groq API Docs](https://console.groq.com/docs)

---

## 📞 Contacto y Soporte

Si tienes problemas con el despliegue:

1. **Revisa los logs** en el Dashboard de Render
2. **Consulta esta guía** de nuevo
3. **Contacta al equipo** (ver README principal)

---

## ✅ Checklist de Despliegue

Antes de desplegar, verifica:

- [ ] El código está en el repositorio Git
- [ ] Tienes tu Groq API Key
- [ ] Has configurado `render.yaml` (si usas Blueprint)
- [ ] El `.node-version` está presente en `/web`
- [ ] Los archivos `.env` NO están en Git (verificar `.gitignore`)
- [ ] Has probado el build localmente: `npm run build`

Una vez desplegado:

- [ ] La URL de producción funciona
- [ ] Todas las páginas cargan correctamente
- [ ] Groq API funciona (verifica en `/diagnostic`)
- [ ] Los estilos se ven correctos
- [ ] La navegación funciona
- [ ] Has actualizado la URL en `astro.config.mjs` si es necesario

---

**¡Listo para producción! 🚀**
